<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Metascripts / Cloud Scripts | ImmyDocs</title>
    <meta name="generator" content="VuePress 1.9.8">
    
    <meta name="description" content="">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.efe19a0a.css" as="style"><link rel="preload" href="/assets/js/app.3f39f6f6.js" as="script"><link rel="preload" href="/assets/js/3.d32d2dc6.js" as="script"><link rel="preload" href="/assets/js/20.85319fcc.js" as="script"><link rel="prefetch" href="/assets/js/10.08036946.js"><link rel="prefetch" href="/assets/js/11.30988960.js"><link rel="prefetch" href="/assets/js/12.707814af.js"><link rel="prefetch" href="/assets/js/13.35367a68.js"><link rel="prefetch" href="/assets/js/14.e538544d.js"><link rel="prefetch" href="/assets/js/15.dbdc58d4.js"><link rel="prefetch" href="/assets/js/16.ccd7b290.js"><link rel="prefetch" href="/assets/js/17.ce07769e.js"><link rel="prefetch" href="/assets/js/18.eabd3433.js"><link rel="prefetch" href="/assets/js/19.9d138554.js"><link rel="prefetch" href="/assets/js/21.0e341364.js"><link rel="prefetch" href="/assets/js/22.da4a7478.js"><link rel="prefetch" href="/assets/js/23.9a3fa37d.js"><link rel="prefetch" href="/assets/js/4.be4564af.js"><link rel="prefetch" href="/assets/js/5.b6ab2f2c.js"><link rel="prefetch" href="/assets/js/6.628dfb5f.js"><link rel="prefetch" href="/assets/js/7.55353eb1.js"><link rel="prefetch" href="/assets/js/8.b2cb61cd.js"><link rel="prefetch" href="/assets/js/9.31a3bce2.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.6d7b943b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.efe19a0a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">ImmyDocs</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div> <a href="https://github.com/immense/immybot-documentation" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div> <a href="https://github.com/immense/immybot-documentation" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>What's New</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/releases.html" class="sidebar-link">Releases</a></li></ul></section></li><li><a href="/" aria-current="page" class="sidebar-link">Getting Started</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/#preface" class="sidebar-link">Preface</a></li><li class="sidebar-sub-header"><a href="/#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/#create-your-trial-instance" class="sidebar-link">Create your trial instance</a></li><li class="sidebar-sub-header"><a href="/#setup-your-first-computer" class="sidebar-link">Setup your first Computer</a></li><li class="sidebar-sub-header"><a href="/#recommended-deployments" class="sidebar-link">Recommended Deployments</a></li><li class="sidebar-sub-header"><a href="/#testing-with-windows-sandbox" class="sidebar-link">Testing with Windows Sandbox</a></li><li class="sidebar-sub-header"><a href="/#adding-users" class="sidebar-link">Adding Users</a></li><li class="sidebar-sub-header"><a href="/#user-roles" class="sidebar-link">User Roles</a></li><li class="sidebar-sub-header"><a href="/#terminology" class="sidebar-link">Terminology</a></li><li class="sidebar-sub-header"><a href="/#deployment-resolution" class="sidebar-link">Deployment Resolution</a></li><li class="sidebar-sub-header"><a href="/#identification-failures" class="sidebar-link">Identification Failures</a></li><li class="sidebar-sub-header"><a href="/#pending-computers" class="sidebar-link">Pending Computers</a></li><li class="sidebar-sub-header"><a href="/#security-software-exclusions" class="sidebar-link">Security Software Exclusions</a></li></ul></li><li><a href="/FAQ.html" class="sidebar-link">Frequently Asked Questions</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/FAQ.html#do-i-need-a-separate-usb-installer-per-tenant" class="sidebar-link">Do I need a separate USB/Installer per tenant?</a></li><li class="sidebar-sub-header"><a href="/FAQ.html#will-immybot-start-doing-anything-without-my-consent-like-when-i-save-a-deployment-will-it-automatically-deploy" class="sidebar-link">Will ImmyBot start doing anything without my consent? Like when I save a deployment, will it automatically deploy?</a></li><li class="sidebar-sub-header"><a href="/FAQ.html#what-if-i-don-t-know-which-user-will-be-using-the-computer" class="sidebar-link">What if I don’t know which user will be using the computer?</a></li><li class="sidebar-sub-header"><a href="/FAQ.html#can-immy-join-azuread" class="sidebar-link">Can Immy join AzureAD?</a></li><li class="sidebar-sub-header"><a href="/FAQ.html#can-immy-help-migrate-my-customers-to-azuread-from-on-premises-environments" class="sidebar-link">Can Immy help migrate my customers to AzureAD from On-Premises environments?</a></li><li class="sidebar-sub-header"><a href="/FAQ.html#domain-join-didn-t-work-what-gives" class="sidebar-link">Domain Join didn’t work, what gives?</a></li><li class="sidebar-sub-header"><a href="/FAQ.html#why-are-my-computers-stuck-in-identification" class="sidebar-link">Why are my computers stuck in Identification</a></li><li class="sidebar-sub-header"><a href="/FAQ.html#can-you-target-devices-in-azure-groups" class="sidebar-link">Can you target devices in Azure Groups?</a></li><li class="sidebar-sub-header"><a href="/FAQ.html#how-do-i-uninstall-the-immyagent" class="sidebar-link">How do I uninstall the ImmyAgent?</a></li><li class="sidebar-sub-header"><a href="/FAQ.html#how-are-we-able-to-define-which-version-of-windows-is-installed-during-the-initial-setup" class="sidebar-link">How/are we able to define which version of Windows is installed during the initial setup?</a></li><li class="sidebar-sub-header"><a href="/FAQ.html#since-immy-bot-doesn-t-use-an-iso-does-it-require-a-device-to-have-the-ability-to-have-2-usb-devices-plugged-in-one-for-a-windows-iso-and-one-for-the-immybot-ppkg" class="sidebar-link">Since Immy.Bot doesn’t use an ISO, does it require a device to have the ability to have 2 USB devices plugged in? One for a Windows ISO and one for the ImmyBot ppkg?</a></li><li class="sidebar-sub-header"><a href="/FAQ.html#does-immy-rely-on-the-windows-preboot-for-drivers-during-initial-deployment-or-does-the-immybot-agent-installer-have-drivers" class="sidebar-link">Does Immy rely on the Windows preboot for drivers during initial deployment, or does the ImmyBot agent installer have drivers?</a></li><li class="sidebar-sub-header"><a href="/FAQ.html#does-immy-s-setup-process-support-a-usb-nic-for-wifi-if-so-how-do-we-present-those-drivers-to-immy-or-do-we-even-need-to" class="sidebar-link">Does Immy’s setup process support a USB NIC for WiFi?  If so, how do we present those drivers to Immy, or do we even need to?</a></li><li class="sidebar-sub-header"><a href="/FAQ.html#sentinelone-how-do-we-define-which-site-immy-bot-places-the-agent-in-during-installation-of-the-s1-agent" class="sidebar-link">SentinelOne - How do we define which site Immy.Bot places the agent in during installation of the S1 agent?</a></li><li class="sidebar-sub-header"><a href="/FAQ.html#are-there-any-repository-limits-for-software-deployments-either-to-the-size-of-custom-software-or-number-of-custom-installers-we-can-upload" class="sidebar-link">Are there any repository limits for software deployments?  Either to the size of custom software or number of custom installers we can upload?</a></li><li class="sidebar-sub-header"><a href="/FAQ.html#employee-profile-caching-during-on-boarding-is-this-supported-if-so-how" class="sidebar-link">Employee profile caching during on-boarding - is this supported?  If so/how?</a></li><li class="sidebar-sub-header"><a href="/FAQ.html#for-purchasing-immy-do-you-guys-prefer-credit-card-or-invoice-would-you-rather-us-pay-monthly-or-can-we-pay-all-upfront" class="sidebar-link">For purchasing Immy, do you guys prefer Credit card or invoice? Would you rather us pay monthly, or can we pay all upfront?</a></li><li class="sidebar-sub-header"><a href="/FAQ.html#is-immy-able-to-group-devices-and-then-do-role-based-deployments-to-them-i-assume-this-is-done-by-tags" class="sidebar-link">Is Immy able to group devices and then do role based deployments to them? I assume this is done by tags?</a></li><li class="sidebar-sub-header"><a href="/FAQ.html#bitlocker-does-this-write-the-key-to-azure-ad-by-chance" class="sidebar-link">BitLocker - does this write the key to Azure AD by chance?</a></li><li class="sidebar-sub-header"><a href="/FAQ.html#is-immy-able-to-reset-windows-wipe-and-reload-a-computer" class="sidebar-link">Is Immy able to reset Windows / Wipe and Reload a computer?</a></li><li class="sidebar-sub-header"><a href="/FAQ.html#immybot-agent-logs-show-an-error-of-the-specified-sas-token-is-expired" class="sidebar-link">ImmyBot Agent logs show an error of &quot;The specified SAS token is expired&quot;</a></li><li class="sidebar-sub-header"><a href="/FAQ.html#what-are-trusted-manufacturers" class="sidebar-link">What are trusted manufacturers?</a></li></ul></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Advanced</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/scripts.html" class="sidebar-link">Scripting Guide</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/scripts.html#best-practices" class="sidebar-link">Best Practices</a></li><li class="sidebar-sub-header"><a href="/scripts.html#script-types" class="sidebar-link">Script Types</a></li><li class="sidebar-sub-header"><a href="/scripts.html#script-execution-contexts" class="sidebar-link">Script Execution Contexts</a></li><li class="sidebar-sub-header"><a href="/scripts.html#variables" class="sidebar-link">Variables</a></li><li class="sidebar-sub-header"><a href="/scripts.html#scripting-frequently-asked-questions" class="sidebar-link">Scripting Frequently Asked Questions</a></li><li class="sidebar-sub-header"><a href="/scripts.html#configuration-task-helper-functions" class="sidebar-link">Configuration Task Helper Functions</a></li></ul></li><li><a href="/immy-commands.html" aria-current="page" class="active sidebar-link">Metascripts / Cloud Scripts</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/immy-commands.html#example" class="sidebar-link">Example</a></li><li class="sidebar-sub-header"><a href="/immy-commands.html#output" class="sidebar-link">Output</a></li><li class="sidebar-sub-header"><a href="/immy-commands.html#cloud-scripts" class="sidebar-link">Cloud Scripts</a></li><li class="sidebar-sub-header"><a href="/immy-commands.html#common-commands" class="sidebar-link">Common Commands</a></li><li class="sidebar-sub-header"><a href="/immy-commands.html#metascript-commands" class="sidebar-link">Metascript Commands</a></li><li class="sidebar-sub-header"><a href="/immy-commands.html#filterscript-commands" class="sidebar-link">Filterscript Commands</a></li><li class="sidebar-sub-header"><a href="/immy-commands.html#software-auto-update-commands" class="sidebar-link">Software Auto Update Commands</a></li><li class="sidebar-sub-header"><a href="/immy-commands.html#cw-automate-commands" class="sidebar-link">CW Automate Commands</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Integrations</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/connectwise-automate-integration-setup.html" class="sidebar-link">ConnectWise Automate</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/connectwise-automate-integration-setup.html#create-immybot-role" class="sidebar-link">Create ImmyBot Role</a></li><li class="sidebar-sub-header"><a href="/connectwise-automate-integration-setup.html#create-immybot-user" class="sidebar-link">Create ImmyBot User</a></li><li class="sidebar-sub-header"><a href="/connectwise-automate-integration-setup.html#enable-google-mfa-for-immybot-user" class="sidebar-link">Enable Google MFA for ImmyBot User</a></li><li class="sidebar-sub-header"><a href="/connectwise-automate-integration-setup.html#add-rmm-link-for-cw-automate" class="sidebar-link">Add RMM Link for CW Automate</a></li><li class="sidebar-sub-header"><a href="/connectwise-automate-integration-setup.html#import-your-customers" class="sidebar-link">Import your customers</a></li></ul></li><li><a href="/connectwise-control-integration-setup.html" class="sidebar-link">ConnectWise Control</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/connectwise-control-integration-setup.html#install-immybot-extension-for-control" class="sidebar-link">Install ImmyBot Extension for Control</a></li><li class="sidebar-sub-header"><a href="/connectwise-control-integration-setup.html#create-rmmlink-for-control" class="sidebar-link">Create RMMLink for Control</a></li><li class="sidebar-sub-header"><a href="/connectwise-control-integration-setup.html#import-your-customers" class="sidebar-link">Import your customers</a></li><li class="sidebar-sub-header"><a href="/connectwise-control-integration-setup.html#troubleshooting" class="sidebar-link">Troubleshooting</a></li></ul></li><li><a href="/connectwise-manage-integration-setup.html" class="sidebar-link">ConnectWise Manage</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/connectwise-manage-integration-setup.html#create-an-immybot-role-with-the-following-permissions" class="sidebar-link">Create an ImmyBot Role with the following permissions</a></li><li class="sidebar-sub-header"><a href="/connectwise-manage-integration-setup.html#create-an-api-member" class="sidebar-link">Create an API Member</a></li><li class="sidebar-sub-header"><a href="/connectwise-manage-integration-setup.html#plugin-the-api-keys-in-immybot" class="sidebar-link">Plugin the API Keys in ImmyBot</a></li></ul></li><li><a href="/ncentral-integration-setup.html" class="sidebar-link">N-Central Integration</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ncentral-integration-setup.html#create-immybot-role-in-n-central" class="sidebar-link">Create ImmyBot Role in N-Central</a></li><li class="sidebar-sub-header"><a href="/ncentral-integration-setup.html#create-immybot-user-in-n-central" class="sidebar-link">Create ImmyBot user in N-Central</a></li><li class="sidebar-sub-header"><a href="/ncentral-integration-setup.html#login-to-the-new-immybot-user-to-get-mfa-code-and-accept-eula" class="sidebar-link">Login to the new ImmyBot user to get MFA code and accept EULA</a></li><li class="sidebar-sub-header"><a href="/ncentral-integration-setup.html#add-integration-for-n-central" class="sidebar-link">Add integration for N-Central</a></li><li class="sidebar-sub-header"><a href="/ncentral-integration-setup.html#import-your-customers" class="sidebar-link">Import your customers</a></li><li class="sidebar-sub-header"><a href="/ncentral-integration-setup.html#troubleshooting" class="sidebar-link">Troubleshooting</a></li></ul></li><li><a href="/azure-graph-permissions-setup.html" class="sidebar-link">AzureAD/365 Graph Permissions</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/azure-graph-permissions-setup.html#default" class="sidebar-link">Default</a></li><li class="sidebar-sub-header"><a href="/azure-graph-permissions-setup.html#custom" class="sidebar-link">Custom</a></li><li class="sidebar-sub-header"><a href="/azure-graph-permissions-setup.html#gdap-customer-syncing" class="sidebar-link">GDAP Customer Syncing</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="metascripts-cloud-scripts"><a href="#metascripts-cloud-scripts" class="header-anchor">#</a> Metascripts / Cloud Scripts</h1> <p>A Metascript is a script that runs scripts. These scripts run in the backend of ImmyBot.</p> <p>A Metascript can run a script on a computer using Invoke-ImmyCommand.</p> <h2 id="example"><a href="#example" class="header-anchor">#</a> Example</h2> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token variable">$ServerPSVersionTable</span> = <span class="token variable">$PSVersionTable</span>
<span class="token variable">$ComputerPSVersionTable</span> = <span class="token function">Invoke-ImmyCommand</span> <span class="token punctuation">{</span>
    <span class="token variable">$ServerPSVersionTable</span> = <span class="token variable">$using</span>:ServerPSVersionTable
    <span class="token function">Write-Host</span> <span class="token string">&quot;Running from <span class="token variable">$env</span>:ComputerName but ImmyBot backend is running PowerShell <span class="token function">$<span class="token punctuation">(</span><span class="token variable">$ServerPSVersionTable</span><span class="token punctuation">.</span>PSVersion<span class="token punctuation">)</span></span>&quot;</span> <span class="token operator">-</span>ForegroundColor Green
    <span class="token keyword">return</span> <span class="token variable">$PSVersionTable</span>
<span class="token punctuation">}</span>
<span class="token variable">$VerbosePreference</span> = <span class="token string">'Continue'</span>
<span class="token function">Write-Verbose</span> <span class="token string">&quot;Running from ImmyBot backend, but the computer is running Windows PowerShell <span class="token function">$<span class="token punctuation">(</span><span class="token variable">$ComputerPSVersionTable</span><span class="token punctuation">.</span>PSVersion<span class="token punctuation">)</span></span>&quot;</span>
</code></pre></div><h2 id="output"><a href="#output" class="header-anchor">#</a> Output</h2> <p><img src="https://user-images.githubusercontent.com/1424395/186782839-81293dbb-8206-4dbb-be78-f94efbfbbacf.png" alt="image"></p> <p>Invoke-ImmyCommand is modelled after PowerShell's native Invoke-Command, up to and including the ability to pass real objects into and out of the remote runspace, while preserving stream information. We consider our approach superior to capturing standard output and standard error as a string like most automation tools.</p> <p>Metascripts allow you to do things like persist reboots since the context is held by the backend.</p> <h2 id="cloud-scripts"><a href="#cloud-scripts" class="header-anchor">#</a> Cloud Scripts</h2> <p>A Cloud script is the same as a Metascript except it targets a Tenant instead of a specific computer. This is useful for manipulating settings in each customer's Azure environment.</p> <p>Collectively we refer to Metascripts and Cloud scripts as server-side scripts.</p> <h2 id="common-commands"><a href="#common-commands" class="header-anchor">#</a> Common Commands</h2> <p>These commands are available in all server-side scripts.</p> <h3 id="connect-immyazuread"><a href="#connect-immyazuread" class="header-anchor">#</a> Connect-ImmyAzureAD</h3> <p>Provides a wrapper around <code>Connect-AzureAD</code></p> <ul><li>https://docs.microsoft.com/en-us/powershell/module/azuread/connect-azuread?view=azureadps-2.0</li></ul> <h4 id="example-2"><a href="#example-2" class="header-anchor">#</a> Example</h4> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token function">Connect-ImmyAzureAD</span> 
<span class="token function">Get-AzureADUser</span> <span class="token operator">-</span>All <span class="token boolean">$true</span>
</code></pre></div><h3 id="get-immyazureauthheader"><a href="#get-immyazureauthheader" class="header-anchor">#</a> Get-ImmyAzureAuthHeader</h3> <p>Obtains an auth header for the specified endpoint</p> <h4 id="usage"><a href="#usage" class="header-anchor">#</a> Usage</h4> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token function">Get-ImmyAzureAuthHeader</span> <span class="token punctuation">[</span><span class="token operator">-</span>Endpoint<span class="token punctuation">]</span> &lt;<span class="token punctuation">[</span><span class="token string">&quot;MSGraph&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;AzureAD&quot;</span><span class="token punctuation">]</span>&gt;
</code></pre></div><p>Returns a <code>[dictionary]</code> containing the auth header</p> <h4 id="examples"><a href="#examples" class="header-anchor">#</a> Examples</h4> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token variable">$Header</span> = <span class="token function">Get-ImmyAzureAuthHeader</span> <span class="token operator">-</span>ErrorAction Stop
<span class="token variable">$Groups</span> = <span class="token function">Invoke-RestMethod</span> &quot;https:<span class="token operator">/</span><span class="token operator">/</span>graph<span class="token punctuation">.</span>microsoft<span class="token punctuation">.</span>com<span class="token operator">/</span>v1<span class="token punctuation">.</span>0<span class="token operator">/</span>groups<span class="token operator">/</span>
</code></pre></div><h3 id="get-providerinfo"><a href="#get-providerinfo" class="header-anchor">#</a> Get-ProviderInfo</h3> <p>Retrieves an instance of an RMM Provider for the specified type.</p> <h4 id="alias"><a href="#alias" class="header-anchor">#</a> Alias</h4> <p>Get-RmmInfo</p> <h4 id="usage-2"><a href="#usage-2" class="header-anchor">#</a> Usage</h4> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token function">Get-ProviderInfo</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span>ProviderType<span class="token punctuation">]</span> &lt;string&gt;<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span>IncludeClients<span class="token punctuation">]</span> <span class="token punctuation">[</span>&lt;CommonParameters&gt;<span class="token punctuation">]</span>
</code></pre></div><h4 id="examples-2"><a href="#examples-2" class="header-anchor">#</a> Examples</h4> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token keyword">param</span><span class="token punctuation">(</span>
    <span class="token namespace">[string]</span><span class="token variable">$FieldName</span><span class="token punctuation">,</span>
    <span class="token namespace">[string]</span><span class="token variable">$Value</span><span class="token punctuation">,</span>
    <span class="token variable">$Computer</span>
<span class="token punctuation">)</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$Computer</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$Computer</span> = <span class="token function">Get-ImmyComputer</span>
<span class="token punctuation">}</span>
<span class="token variable">$RmmComputer</span> = <span class="token function">Get-RmmComputer</span> <span class="token operator">-</span>Computer <span class="token variable">$Computer</span> <span class="token operator">-</span>ProviderType CWAutomate
<span class="token variable">$RmmInfo</span> = <span class="token function">Get-ProviderInfo</span> <span class="token operator">-</span>ProviderType CWAutomate

<span class="token variable">$EDF</span> = <span class="token function">Get-CWAComputerEDF</span> <span class="token operator">-</span>FieldName <span class="token variable">$FieldName</span> <span class="token operator">-</span>Computer <span class="token variable">$Computer</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$EDF</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">Write-Warning</span> <span class="token string">&quot;Aborting: Unable to find EDF <span class="token variable">$FieldName</span>&quot;</span>
    <span class="token keyword">return</span>
<span class="token punctuation">}</span>

<span class="token variable">$ExtraFieldDefinitionId</span> = <span class="token variable">$EDF</span><span class="token punctuation">.</span>ExtraFieldDefinitionId
<span class="token variable">$ValueProperty</span> = <span class="token variable">$EDF</span> <span class="token punctuation">|</span> <span class="token function">select</span> <span class="token operator">*</span>FieldSettings<span class="token operator">*</span> <span class="token punctuation">|</span> <span class="token function">Get-Member</span> <span class="token operator">-</span>MemberType NoteProperty <span class="token punctuation">|</span> <span class="token function">select</span> <span class="token operator">-</span>First 1 <span class="token punctuation">|</span> <span class="token operator">%</span><span class="token punctuation">{</span><span class="token variable">$_</span><span class="token punctuation">.</span>Name<span class="token punctuation">}</span>
<span class="token variable">$PatchPath</span> = <span class="token string">&quot;<span class="token variable">$ValueProperty</span>/Value&quot;</span>
<span class="token variable">$Uri</span> = <span class="token string">&quot;cwa/api/v1/computers/<span class="token function">$<span class="token punctuation">(</span><span class="token variable">$RmmComputer</span><span class="token punctuation">.</span>RmmDeviceId<span class="token punctuation">)</span></span>/extrafields/<span class="token variable">$ExtraFieldDefinitionId</span>&quot;</span>
<span class="token variable">$Body</span> = <span class="token function">ConvertTo-Json</span> @<span class="token punctuation">(</span>@<span class="token punctuation">{</span><span class="token string">&quot;op&quot;</span>=<span class="token string">&quot;replace&quot;</span><span class="token punctuation">;</span><span class="token string">&quot;path&quot;</span>=<span class="token variable">$PatchPath</span><span class="token punctuation">;</span><span class="token string">&quot;value&quot;</span>=<span class="token variable">$Value</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">Invoke-CWARestMethod</span> <span class="token variable">$Uri</span> <span class="token operator">-</span>Provider <span class="token variable">$RmmInfo</span><span class="token punctuation">.</span>Provider <span class="token operator">-</span>Method PATCH <span class="token operator">-</span>Body <span class="token variable">$Body</span>
</code></pre></div><h2 id="metascript-commands"><a href="#metascript-commands" class="header-anchor">#</a> Metascript Commands</h2> <h3 id="invoke-immycommand"><a href="#invoke-immycommand" class="header-anchor">#</a> Invoke-ImmyCommand</h3> <p>A powerful command that allows you to execute scripts remotely on devices.</p> <h4 id="usage-3"><a href="#usage-3" class="header-anchor">#</a> Usage</h4> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token function">Invoke-ImmyCommand</span> <span class="token punctuation">[</span><span class="token operator">-</span>ScriptBlock<span class="token punctuation">]</span> &lt;Object&gt; <span class="token punctuation">[</span><span class="token operator">-</span>Computer &lt;PSComputer&gt;<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span>Context &lt;string&gt;<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span>ArgumentList &lt;array&gt;<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span>Timeout &lt;int&gt;<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span>ConnectTimeout &lt;int&gt;<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span>DisableConnectTimeoutWarnings<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token keyword">Parallel</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>&lt;CommonParameters&gt;<span class="token punctuation">]</span>
</code></pre></div><p><code>-Context</code> accepts either &quot;System&quot; or &quot;User&quot;</p> <p><code>-Timeout</code> accepts an integer denoted in seconds. The default is 120.</p> <p><code>-Parallel</code> (switch, makes the script block run on all the computers simultaneously instead of in series)</p> <p><code>-ConnectTimeout</code> (integer, seconds, to override the amount of time before giving up on trying to start the script on a computer)</p> <p><code>-DisableConnectTimeoutWarnings</code> (switch, to suppress &quot;WARNING: Timed out waiting for script to start on COMPUTER&quot; for every computer that fails to start within the connect timeout).</p> <h4 id="examples-3"><a href="#examples-3" class="header-anchor">#</a> Examples</h4> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token comment">&lt;# Execute a metascript against the primary computer #&gt;</span>
<span class="token function">Invoke-ImmyCommand</span> <span class="token punctuation">{</span>
  <span class="token comment">&lt;# add powershell to run on the comptuer #&gt;</span>
  <span class="token function">write-output</span> <span class="token string">&quot;hello&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token comment">&lt;# Retrieve a list of computers and run a command on all of them #&gt;</span>
<span class="token function">Get-ImmyComputer</span> <span class="token operator">-</span>TargetGroupFilter All <span class="token punctuation">|</span> <span class="token function">Invoke-ImmyCommand</span> <span class="token punctuation">{</span>
  <span class="token function">Write-Output</span> <span class="token string">&quot;Hello&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="send-immyemail"><a href="#send-immyemail" class="header-anchor">#</a> Send-ImmyEmail</h3> <p>Sends an Immybot styled email.  If no <code>To</code> is provided, then the email will be sent using the same logic for sending the detection emails during a maintenance session.</p> <h4 id="usage-4"><a href="#usage-4" class="header-anchor">#</a> Usage</h4> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token function">Send-ImmyEmail</span> <span class="token punctuation">[</span><span class="token operator">-</span>Subject<span class="token punctuation">]</span> &lt;string&gt; <span class="token punctuation">[</span><span class="token operator">-</span>Body<span class="token punctuation">]</span> &lt;string&gt; <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span>To<span class="token punctuation">]</span> &lt;List<span class="token namespace">[string]</span>&gt;<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span>Bcc<span class="token punctuation">]</span> &lt;List<span class="token namespace">[string]</span>&gt;<span class="token punctuation">]</span>
</code></pre></div><h4 id="examples-4"><a href="#examples-4" class="header-anchor">#</a> Examples</h4> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token comment">&lt;# Sends an email using the same logic used in sending detection emails out during maintenance. #&gt;</span>
<span class="token function">Send-ImmyEmail</span> <span class="token operator">-</span>Subject <span class="token string">&quot;Test&quot;</span> <span class="token operator">-</span>Body <span class="token string">&quot;Some Body&quot;</span>
</code></pre></div><h3 id="refresh-computersysteminfo"><a href="#refresh-computersysteminfo" class="header-anchor">#</a> Refresh-ComputerSystemInfo</h3> <h4 id="usage-5"><a href="#usage-5" class="header-anchor">#</a> Usage</h4> <p>This command will run an inventory command to refresh the following computer information:</p> <ul><li>ComputerName</li> <li>SerialNumber</li> <li>ChassisTypes</li> <li>DomainRole</li> <li>Domain</li> <li>OsName</li> <li>OsInstallDate</li> <li>LastBootTime</li> <li>Model</li> <li>Manufacturer</li></ul> <div class="language-powershell extra-class"><pre class="language-powershell"><code>Refresh<span class="token operator">-</span>ComputerSystemInfo <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span>Computer<span class="token punctuation">]</span> &lt;PSComputer&gt;<span class="token punctuation">]</span>
</code></pre></div><h4 id="examples-5"><a href="#examples-5" class="header-anchor">#</a> Examples</h4> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token comment">&lt;# If you do not supply the Computer parameter, then it will default to using the computer for the current session #&gt;</span>
Refresh<span class="token operator">-</span>ComputerSystemInfo
</code></pre></div><div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token comment">&lt;# This will refresh the computer system info for all servers. #&gt;</span>
<span class="token function">Get-ImmyComputer</span> <span class="token operator">-</span>TargetGroupFilter Servers <span class="token punctuation">|</span> Refresh<span class="token operator">-</span>ComputerSystemInfo
</code></pre></div><h3 id="get-rmmcomputer"><a href="#get-rmmcomputer" class="header-anchor">#</a> Get-RmmComputer</h3> <p>Coming Soon</p> <h3 id="get-immycomputer"><a href="#get-immycomputer" class="header-anchor">#</a> Get-ImmyComputer</h3> <p>Coming Soon</p> <h2 id="filterscript-commands"><a href="#filterscript-commands" class="header-anchor">#</a> Filterscript Commands</h2> <h3 id="get-immycomputer-2"><a href="#get-immycomputer-2" class="header-anchor">#</a> Get-ImmyComputer</h3> <p>Returns a list of computers for the specified tenant, or all computers if it is cross tenant scoped.</p> <h4 id="usage-6"><a href="#usage-6" class="header-anchor">#</a> Usage</h4> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token function">Get-ImmyComputer</span> <span class="token punctuation">[</span><span class="token operator">-</span>InventoryKeys<span class="token punctuation">]</span> &lt;string<span class="token punctuation">[</span><span class="token punctuation">]</span>&gt;
</code></pre></div><h4 id="examples-6"><a href="#examples-6" class="header-anchor">#</a> Examples</h4> <p>Coming soon</p> <h2 id="software-auto-update-commands"><a href="#software-auto-update-commands" class="header-anchor">#</a> Software Auto Update Commands</h2> <h3 id="add-script"><a href="#add-script" class="header-anchor">#</a> Add-Script</h3> <p>Coming Soon</p> <h3 id="get-script"><a href="#get-script" class="header-anchor">#</a> Get-Script</h3> <p>Coming Soon</p> <h3 id="add-softwareversion"><a href="#add-softwareversion" class="header-anchor">#</a> Add-SoftwareVersion</h3> <h4 id="usage-7"><a href="#usage-7" class="header-anchor">#</a> Usage</h4> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token function">Add-SoftwareVersion</span> <span class="token punctuation">[</span><span class="token operator">-</span>SoftwareVersion &lt;SoftwareVersion&gt;<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token operator">-</span>SoftwareType <span class="token punctuation">{</span>GlobalSoftware <span class="token punctuation">|</span> LocalSoftware <span class="token punctuation">|</span> WindowsUpdate <span class="token punctuation">|</span> Chocolatey <span class="token punctuation">|</span> Ninite<span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token operator">-</span>DisplayName &lt;string&gt;<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token operator">-</span>SemanticVersion &lt;string&gt;<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token operator">-</span>TestRequired &lt;bool&gt;<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token operator">-</span>Url &lt;string&gt;<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token operator">-</span>RelativeCacheSourcePath &lt;string&gt;<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token operator">-</span>InstallerFile &lt;string&gt;<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token operator">-</span>PackageHash &lt;string&gt;<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token operator">-</span>TestFailedError &lt;string&gt;<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token operator">-</span>InstallScriptId &lt;int&gt;<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token operator">-</span>InstallScriptType <span class="token punctuation">{</span>Global <span class="token punctuation">|</span> Local<span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token operator">-</span>TestScriptId &lt;int&gt;<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token operator">-</span>TestScriptType <span class="token punctuation">{</span>Global <span class="token punctuation">|</span> Local<span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token operator">-</span>UpgradeScriptId &lt;int&gt;<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token operator">-</span>UpgradeScriptType <span class="token punctuation">{</span>Global <span class="token punctuation">|</span> Local<span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token operator">-</span>UninstallScriptId &lt;int&gt;<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token operator">-</span>UninstallScriptType <span class="token punctuation">{</span>Global <span class="token punctuation">|</span> Local<span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token operator">-</span>PostInstallScriptId &lt;int&gt;<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token operator">-</span>PostInstallScriptType <span class="token punctuation">{</span>Global <span class="token punctuation">|</span> Local<span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token operator">-</span>PostUninstallScriptId &lt;int&gt;<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token operator">-</span>PostUninstallScriptType <span class="token punctuation">{</span>Global <span class="token punctuation">|</span> Local<span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token operator">-</span>LicenseType <span class="token punctuation">{</span>None <span class="token punctuation">|</span> LicenseFile <span class="token punctuation">|</span> Key<span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token operator">-</span>UpgradeStrategy <span class="token punctuation">{</span>None <span class="token punctuation">|</span> UninstallInstall <span class="token punctuation">|</span> InstallOver <span class="token punctuation">|</span> UpgradeScript<span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token operator">-</span>PackageType <span class="token punctuation">{</span>None <span class="token punctuation">|</span> EntireFolder <span class="token punctuation">|</span> InstallerFile<span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token operator">-</span>InstallerType <span class="token punctuation">{</span>None <span class="token punctuation">|</span> File <span class="token punctuation">|</span> Url<span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token operator">-</span>BlobName &lt;string&gt;<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token operator">-</span>Notes &lt;string&gt;<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token operator">-</span>ProductCode &lt;string&gt;<span class="token punctuation">]</span>
  <span class="token punctuation">[</span>&lt;CommonParameters&gt;<span class="token punctuation">]</span>
</code></pre></div><h4 id="examples-7"><a href="#examples-7" class="header-anchor">#</a> Examples</h4> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token variable">$download_page</span> = <span class="token function">Invoke-WebRequest</span> <span class="token operator">-</span>Uri <span class="token string">'https://github.com/dbeaver/dbeaver/releases/latest'</span> <span class="token operator">-</span>UseBasicParsing
<span class="token variable">$url</span> = <span class="token variable">$download_page</span><span class="token punctuation">.</span>links <span class="token punctuation">|</span> ? href <span class="token operator">-match</span> <span class="token string">'\.exe$'</span> <span class="token punctuation">|</span> <span class="token function">select</span> <span class="token operator">-</span>Expand href <span class="token operator">-</span>First 1 <span class="token punctuation">|</span> <span class="token operator">%</span> <span class="token punctuation">{</span> <span class="token string">'https://github.com'</span> <span class="token operator">+</span> <span class="token variable">$_</span> <span class="token punctuation">}</span>
<span class="token variable">$versionString</span> = <span class="token variable">$url</span> <span class="token operator">-</span>split <span class="token string">'/'</span> <span class="token punctuation">|</span> <span class="token function">select</span> <span class="token operator">-</span>Last 1 <span class="token operator">-</span>Skip 1
<span class="token variable">$latestVersion</span> = <span class="token variable">$SoftwareVersions</span> <span class="token punctuation">|</span> <span class="token function">sort</span> SemanticVersion <span class="token punctuation">|</span> <span class="token function">select</span> <span class="token operator">-</span>last 1
<span class="token variable">$createdVersion</span> = <span class="token function">Add-SoftwareVersion</span> <span class="token operator">-</span>SoftwareVersion <span class="token variable">$latestVersion</span> <span class="token operator">-</span>SemanticVersion  <span class="token variable">$versionString</span> <span class="token operator">-</span>Url <span class="token variable">$url</span>
</code></pre></div><h3 id="get-alllocalscripts"><a href="#get-alllocalscripts" class="header-anchor">#</a> Get-AllLocalScripts</h3> <p>Coming Soon</p> <h3 id="get-allglobalscripts"><a href="#get-allglobalscripts" class="header-anchor">#</a> Get-AllGlobalScripts</h3> <p>Coming Soon</p> <h2 id="cw-automate-commands"><a href="#cw-automate-commands" class="header-anchor">#</a> CW Automate Commands</h2> <h3 id="invoke-cwaquery"><a href="#invoke-cwaquery" class="header-anchor">#</a> Invoke-CWAQuery</h3> <p>Coming Soon</p> <h3 id="invoke-cwarestmethod"><a href="#invoke-cwarestmethod" class="header-anchor">#</a> Invoke-CWARestMethod</h3> <p>Coming Soon</p> <h3 id="get-cwarestpages"><a href="#get-cwarestpages" class="header-anchor">#</a> Get-CWARestPages</h3> <p>Coming Soon</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/immense/immybot-documentation/edit/main/src/immy-commands.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/4/2023, 1:33:32 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/scripts.html" class="prev">
        Scripting Guide
      </a></span> <span class="next"><a href="/connectwise-automate-integration-setup.html">
        ConnectWise Automate
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.3f39f6f6.js" defer></script><script src="/assets/js/3.d32d2dc6.js" defer></script><script src="/assets/js/20.85319fcc.js" defer></script>
  </body>
</html>
